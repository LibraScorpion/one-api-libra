# 后台 Admin 全量 PRD（扩充版）

> 目标：为运营/技术提供完整的后台运营能力，覆盖账号/等级/额度与账单、充值与支付、用量与对账、密钥与组织管理，以及审计、安全与报表，保证可配置、可观测、可追溯、可风控。

## 1. 用户角色与权限 （需要设计示意页面）
- 角色：运营、超管（含审计）。
- 权限颗粒：按资源（用户/账单/充值/API Key/机构/通知）+ 动作（查看/创建/编辑/导出/禁用）。
- 保护操作：封号/解封/退款/敏感字段查看需二次确认与审计。

## 2. 导航信息架构（需要设计示意页面）
- 仪表盘（概览卡片：今日新增用户、今日充值额、今日tokens消耗、今日模型成本、今日登录、今日使用人数，以及这些所有的历史记录【今日/本周/本月/本年】）。
- 用户与机构：账号管理、机构管理、成员/Key 管理。
- 产品：账号等级。
- 费用与账单：充值记录、账单管理、退款（只退款剩余额度，最小10美元，小于不退）、代金券/调整、开票/税务。
- 用量与对账：消费明细、模型/渠道/Key 用量、成本对账、导出。
- 安全与风控：登录/支付风控、IP 白黑名单、风控策略。
- 通知与客服：消息中心、模板、工单。
- 系统与审计：权限、审计日志、配置项、国际化/币种。

## 3. 账号管理（用户）（需要设计示意页面）
- 列表字段：
- 普通用户参数：
    用户ID、用户昵称、类型（个人/机构（包括企业，开发组织等，开发者要有开发者标识等内容），类型编辑）、手机号/邮箱、KYC/机构认证（机构认证，admin端手动开放，运营需要填写及提交合作协议及合同，包括机构，开发组织等，个人开发者要有开发者认证标识内容）状态。
    账号等级（个人：余遵守个人充值余额对应TPM等级、机构：遵守协约等级-先不受限-已洽谈好的）、余额/赠送代金券额度、欠费/冻结状态、创建时间、最近登录、备注、操作（这头后台手动开放机构类型的用户，就是先登记，洽谈，然后让对方提供账号/帮助注册账号，并开放机构权限）。
- 机构用户区别：
    机构用户ID、机构类型（个人开发者、企业、开发组织等）、机构认证状态、机构等级、机构余额、机构欠费/冻结状态、机构创建时间、机构最近登录、机构备注、操作。
- 列表显示内容
    用户ID、用户昵称、类型（个人/机构）、手机号/邮箱、KYC/机构认证状态、账号等级、余额/赠送代金券额度、欠费/冻结状态、创建时间、最近登录、备注、操作。
- 筛选：账号/ID、认证状态、等级、余额区间、创建时间、风控状态、欠费/冻结、标签。
- 操作：创建用户、查看详情、编辑基本信息、重置密码、冻结/解冻、调级、发放代金券、配置限流、备注、导出。
- 校验：唯一性（手机号/邮箱）、密码策略、实名信息格式、冻结需原因、代金券领取记录。
- 代金券系统：代金券，自动发送代金券，代金券id，代金券名称，代金券相关描述信息，格式：id：*******，名称“1024代码日”，描述：“祝大家程序员节日快乐，给所有程序员赠送10.24美元代金券，祝大家工作愉快！” 所有人以及多选赠送。

## 3.1 机构合同管理
- 合同上传：账号开放机构权限后要上传对应的合作协议文件，后台可以查看，替换
- 合同是在当前个人用户转换为机构形式后，显示，并可以进行操作
- 合同类型：企业、开发组织
- 合同状态：生效中、已过期、已作废
- 合同操作：查看、下载、替换、作废、续签
- 合同签署：线上签署、线下签署
- 合同模板：合同模板管理（合同文件管理，不是手动输入），合同模板上传，合同模板下载，合同模板删除
- 合同模板类型：企业、开发组织等
- 合同模板操作：查看、下载、替换、删除

## 4. 账号等级
- 适用范围1：普通用户类型
- 余额额度范围，TPM范围
- 充值额度对应TPM量级的账号等级

- 适用范围2：机构用户类型
- 手动适配TPM范围，选择不限TPM范围
- 可超出最大TPM范围

## 5. 额度与余额管理
- 余额类型：余额、赠送余额（代金券）。
- 操作：手工只能发放代金券、冻结/解冻、额度重置、自动扣款策略（余额不足设定的N美元时，提示即将自动充值，并从信用卡/银行卡中扣款）。
- 记录：赠送余额历史记录（来源、类型、金额、操作者、备注）。

## 6. 充值与支付管理
- 充值渠道：银行卡、现金银行（美国）、海外卡/Stripe（可扩展）。
- 列表字段：充值单号、用户/组织、金额/币种、支付方式、渠道订单号、状态（待支付/成功/失败/退款中/已退款）、失败原因、创建/支付时间、操作者。
- 功能：状态查询与轮询、手工确认、补单、关闭订单、退款/部分退款（需权限）、导出、异常单锁定。
- 退款处理：条件余额退款，校验已消费额度（不足需先回收或生成负向账单），原路退或退回余额，需财务复核与审计，生成冲正流水并通知用户。
- 风控：大额充值需审核，频繁失败提示，黑名单限制。

## 7. 账单管理（周期/票据）
- 账单类型：预付扣减明细、后付周期账单（按月/自定义周期）。
- 字段：账单号、账期、用户/组织、起止时间、应付/实付、币种、税率、折扣、欠费、状态（待出账/已出账/待支付/部分支付/已结清/已关闭）、开票状态。
- 功能：生成/出账、发送账单通知、对账（用量-费用-成本）、抵扣顺序（赠送/现金/信用）、欠费停用规则、部分支付、账单重开/作废（需审计）、账单争议处理与冲正（负向账单项）、退款入账（与充值/余额联动）。
- 发票：税号、票据类型、金额范围、开票记录、票据上传/下载。

## 8. 消费明细与用量查询
- 维度：按用户/组织、API Key、模型、渠道、时间区间、请求 ID。
- 字段：时间、模型、渠道、tokens（入/出）、计费单位、单价/倍率、实时扣费金额、缓存节约、供应商成本、毛利、请求状态、延迟。
- 功能：分页、排序、关键词搜索、导出 CSV/异步大导出、成本对账、异常消耗检测（突增/超限）。

## 9. API Key / 凭证管理
- 列表字段：Key ID/前缀、归属用户/组织、状态（启用/禁用/过期）、额度包、限流、绑定模型/权限、最近调用时间、创建时间、备注。
- 操作：创建/禁用/重置、限流配置、IP/域名白名单、标签、权限模板套用、导出（需权限）、强制轮换、泄露锁定。
- 安全：仅显示前缀，完整 Key 复制需权限；操作审计。

## 10. 组织 / 团队管理
- 结构：组织（tenant）下的成员、角色、共享额度与账单。
- 功能：创建组织、成员邀请/移除、角色分配（管理员/财务/开发者/只读）、组织额度与账单视图、Key 分配、跨组织切换、组织标签。
- 结算：组织级账单、组织级充值、成员级用量穿透。

## 11. 风控与安全策略
- 登录安全：多因素、登录失败锁定、IP 风险、设备指纹、敏感操作二次验证。
- 支付/充值风控：黑名单、额度上限、频次控制、大额审核、可疑单拦截。
- 调用风控：异常调用突增报警、违规模型调用限制、地域限制。
- 数据保护：敏感字段脱敏显示，复制需授权；数据导出水印与审计。

## 12. 通知与消息中心
- 通道：邮件、短信、站内信、Webhook（按事件：出账、欠费、额度预警、退款、风控告警、Key 风险）。
- 模板：多语言、变量校验、测试发送、频控（同事件 N 分钟内最多发送 X 次）。
- 订阅：按用户/组织/角色订阅或退订。

## 13. 工单与客服
- 类型：充值问题、账单争议、额度申请、技术支持、合规投诉。
- 字段：工单号、用户/组织、分类、优先级、状态、关联订单/账单、附件、处理人、SLA。
- 功能：分配/转派、催办、评论/内部备注、通知用户、关闭/重开、满意度收集。

## 14. 审计日志与合规
- 记录：关键操作（创建/编辑/删除/启禁用/调级/调额/退款/导出/模拟登录），包含操作者、时间、对象、旧值/新值、来源 IP。
- 查询：按时间、操作者、对象、操作类型筛选，支持导出（需权限）。
- 保留：可配置保留周期，满足合规要求。

## 15. 报表与看板
- 维度：充值趋势、消耗趋势、欠费率、毛利、模型/渠道成本贡献、退款率、风险拦截率、工单 SLA。
- 视图：可选时间粒度（日/周/月）、可配置 KPI 卡片与图表，支持导出。

## 16. 系统设置与配置
- 国际化与币种：多币种汇率、展示与结算币种配置。
- 费用项模板：模型价目、折扣、税率、费用项目（存储、带宽等）可配置。
- 限流与性能：后台接口分页大小、导出阈值、异步任务并发。
- 文件与合规：上传大小/类型、数据脱敏开关。

## 17. 接口与数据
- API 与同步：对外/对内 API 需权限校验；账单与财务系统对接（如 ERP）；支付网关回调。
- 导出：大文件异步，生成后通知；导出内容水印与过期时间。

## 18. 非功能与质量
- 性能：后台查询首屏 ≤ 500ms（分页），导出异步 ≤ 5 分钟完成；高并发下稳定。
- 可用性：核心能力 99.9%；关键任务失败重试与补偿。
- 监控：接口成功率、延迟、错误码、任务队列、支付回调。
- 灰度与回滚：配置变更可灰度/回滚，重要策略支持版本管理。

## 19. 里程碑建议
- M1：账号管理、充值记录、消费明细、Key 管理、基础审计、充值退款/部分退款（人工审核+财务复核）、账单争议基础冲正。
- M2：等级、额度策略、账单出账、通知模板、导出。
- M3：票据、组织/团队、风控策略、看板、工单、退款自动化（规则化审批、批量冲正）。
- M4：国际化/多币种、ERP/支付深度对接、策略灰度与版本化。
