# OpenRouter 转型实施任务

## 1. 后端核心系统

### 1.1 余额系统完善
- [ ] 1.1.1 完善 `model/balance_transaction.go` 交易记录模型
- [ ] 1.1.2 实现 `controller/balance.go` 余额管理 API
- [ ] 1.1.3 添加余额预警功能
- [ ] 1.1.4 实现管理员充值接口

### 1.2 模型定价系统
- [ ] 1.2.1 完善 `model/model_pricing.go` 定价模型
- [ ] 1.2.2 实现模型定价 CRUD API
- [ ] 1.2.3 从 OpenRouter 同步最新定价
- [ ] 1.2.4 添加定价缓存机制

### 1.3 智能渠道路由
- [ ] 1.3.1 创建 `middleware/smart_distributor.go` 智能分发器
- [ ] 1.3.2 实现渠道健康检查 `model/channel_health.go`
- [ ] 1.3.3 实现基于延迟的路由算法
- [ ] 1.3.4 实现基于成本的路由算法
- [ ] 1.3.5 实现故障转移机制
- [ ] 1.3.6 添加渠道权重和优先级配置

### 1.4 计费系统
- [ ] 1.4.1 完善 `relay/billing/billing.go` 计费逻辑
- [ ] 1.4.2 实现实时成本计算
- [ ] 1.4.3 添加请求级别的成本记录
- [ ] 1.4.4 实现余额不足预检查

## 2. API 接口层

### 2.1 OpenAI 兼容 API
- [ ] 2.1.1 完善 Chat Completions 接口
- [ ] 2.1.2 实现 Completions 接口
- [ ] 2.1.3 实现 Embeddings 接口
- [ ] 2.1.4 实现 Models 列表接口

### 2.2 OpenRouter 风格 API
- [ ] 2.2.1 创建 `router/openrouter_api.go` 路由
- [ ] 2.2.2 实现 `/api/v1/models` 模型列表
- [ ] 2.2.3 实现 `/api/v1/models/:id` 模型详情
- [ ] 2.2.4 实现模型搜索和筛选 API
- [ ] 2.2.5 实现模型排行 API

### 2.3 用户管理 API
- [ ] 2.3.1 实现 `/api/auth/google` Google OAuth
- [ ] 2.3.2 完善用户资料 API
- [ ] 2.3.3 实现偏好设置 API

### 2.4 统计分析 API
- [ ] 2.4.1 实现 `/api/activity/logs` 活动日志
- [ ] 2.4.2 实现 `/api/activity/stats` 统计数据
- [ ] 2.4.3 实现用量分析 API
- [ ] 2.4.4 实现成本分析 API

## 3. 数据库改造

### 3.1 新增表
- [ ] 3.1.1 创建 `balance_transactions` 表
- [ ] 3.1.2 创建 `model_pricing` 表
- [ ] 3.1.3 创建 `channel_health` 表
- [ ] 3.1.4 创建 `user_preferences` 表
- [ ] 3.1.5 创建 `model_stats` 表

### 3.2 表结构修改
- [ ] 3.2.1 users 表添加 google_id 字段
- [ ] 3.2.2 channels 表添加健康检查字段
- [ ] 3.2.3 logs 表添加成本相关字段

### 3.3 数据迁移
- [ ] 3.3.1 编写迁移脚本
- [ ] 3.3.2 导入 OpenRouter 模型定价数据
- [ ] 3.3.3 初始化渠道健康数据

## 4. 前端改造

### 4.1 首页重设计
- [ ] 4.1.1 创建 Hero Banner 组件
- [ ] 4.1.2 实现模型搜索框
- [ ] 4.1.3 添加统计卡片
- [ ] 4.1.4 实现热门模型推荐

### 4.2 模型市场页面
- [ ] 4.2.1 创建模型卡片组件
- [ ] 4.2.2 实现筛选器（供应商、能力、价格）
- [ ] 4.2.3 实现搜索功能
- [ ] 4.2.4 实现排序功能
- [ ] 4.2.5 实现分页

### 4.3 模型排行榜
- [ ] 4.3.1 创建排行榜页面
- [ ] 4.3.2 实现多维度榜单切换
- [ ] 4.3.3 添加用量趋势图表

### 4.4 额度管理页面
- [ ] 4.4.1 重设计余额显示
- [ ] 4.4.2 实现交易记录列表
- [ ] 4.4.3 添加用量图表

### 4.5 API Key 管理
- [ ] 4.5.1 改进 Key 列表展示
- [ ] 4.5.2 添加 Key 权限设置
- [ ] 4.5.3 实现使用限制配置

### 4.6 活动记录页面
- [ ] 4.6.1 创建活动记录页面
- [ ] 4.6.2 实现请求日志列表
- [ ] 4.6.3 添加统计图表
- [ ] 4.6.4 实现数据导出

## 5. 认证系统

### 5.1 Google OAuth
- [ ] 5.1.1 配置 Google OAuth 应用
- [ ] 5.1.2 实现后端验证逻辑 `controller/auth_google.go`
- [ ] 5.1.3 实现前端登录按钮
- [ ] 5.1.4 实现账号绑定逻辑

### 5.2 JWT 优化
- [ ] 5.2.1 实现 Token 刷新机制
- [ ] 5.2.2 添加 Token 黑名单

## 6. 测试和文档

### 6.1 测试
- [ ] 6.1.1 编写单元测试
- [ ] 6.1.2 编写 API 集成测试
- [ ] 6.1.3 进行负载测试

### 6.2 文档
- [ ] 6.2.1 更新 API 文档
- [ ] 6.2.2 编写部署指南
- [ ] 6.2.3 编写用户手册
